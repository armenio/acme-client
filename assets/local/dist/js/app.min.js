$(document).ready(function(){"object"!=typeof jwt.user&&($("body").css("min-height",$(window).height()),$("*").removeLoader(),$("body").addLoader(),window.location.href="login.html");var a=function(){var a=$(window).height(),b=$("#header").height(),c=a-b;$("#app").height(c)};a(),$(window).on("resize",function(){a()});var b=function(){$(".navbar-toggler").is(":visible")&&$(".navbar-toggler").trigger("click")};$("aside .form-search").on("submit",function(a){b()}),$(document).on("click","aside a",function(a){b()})});var JsonProducts=[],checkSelectedProducts=function(){$('input[name="ids[]"]:checked').length?$("#products-remove-all").show():$("#products-remove-all").hide()},getProductTpl=function(a){return'<tr>        <td class="td-checkbox">            <label class="custom-control custom-checkbox" for="id_'+a.id+'">                <input type="checkbox" name="ids[]" id="id_'+a.id+'" value="'+a.id+'" class="custom-control-input">                <span class="custom-control-indicator"></span>            </label>        </td>        <td>            <a class="products-view animated" href="#visualizar" data-id="'+a.id+'" data-toggle="modal" data-target="#modal-product">'+a.name+'</a>        </td>        <td class="text-center hidden-sm-down">            <a class="products-view animated" href="#visualizar" data-id="'+a.id+'" data-toggle="modal" data-target="#modal-product">'+(a.stock?a.stock+" unidade"+(a.stock>1?"s":""):'<span class="text-danger">Esgotado!</span>')+'</a>        </td>        <td class="text-center">            <div class="actions hidden-lg-up">                <a class="product-edit animated" href="#editar" data-id="'+a.id+'" data-toggle="modal" data-target="#modal-products"><i class="material-icons">edit</i></a>                <a class="products-remove animated" href="#remover" data-id="'+a.id+'"><i class="material-icons">close</i></a>            </div>            <span class="placeholder"></span>         </td>    </tr>'},updateProductsList=function(){var a=$("#products-list tbody"),b=$.trim($("#element_q").val());$.ajax({url:basePath+"/products",type:"GET",dataType:"json",data:{q:b,order:"stock",by:"asc"},beforeSend:function(b){b.setRequestHeader("Authorization","Bearer "+jwt.token),$("#app").addLoader(),$(".error-message").remove(),a.hide().html("")},success:function(b){if(JsonProducts=b,objectLength(b)>0){a.show();for(var c in b)a.append(getProductTpl(b[c]))}},complete:function(){""==$.trim(a.html())&&(""!==b?a.before('<p class="error-message">Nenhum produto encontrado na busca.</p>                    <p class="error-message"><a class="products-filter animated" href="#todos" data-id="0">Ver todos os produtos</a></p>'):a.before('<p class="error-message">Nenhum produto encontrado.</p>                    <p class="error-message"><a class="products-add btn btn-primary animated" href="#adicioinar-produto" data-toggle="modal" data-target="#modal-products"><i class="icon material-icons">add</i> Cadastrar um produto</a></p>')),checkSelectedProducts(),$("#app").removeLoader()}})};$(document).ready(function(){updateProductsList();var a={id:"",name:"",description:"",price:"",stock:""};$(document).on("click",".products-add, .product-edit",function(b){b.preventDefault();var c=$("#modal-products form");c.closest(".modal").find(".alert, .validation-message").length>0&&c.closest(".modal").find(".alert, .validation-message").remove(),c.bindForm($.extend({},a)),setTimeout(function(){c.find("#element_name").focus()},500)}),$("#modal-products form").zfAjaxForm({beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token);var b=$(this);b.closest(".modal").find(".alert, .validation-message").remove(),b.closest(".modal-content").addLoader()},complete:function(){$(this).closest(".modal-content").removeLoader()},success:function(a){$(this).closest(".modal").modal("hide"),updateProductsList()},error:function(a){var b=$(this),c=a.responseJSON;"string"==typeof c.message&&(showFlashMessenger(b,[{type:"danger",icon:"error",message:"Não foi possível validar os dados."}]),removeFlashMessenger()),"object"==typeof c.errors&&showFormErrorMessages(b,c.errors)}}),$(document).on("click",".product-edit",function(b){b.preventDefault();var c=$(this),d=$("#modal-products form");$.ajax({url:basePath+"/products/"+c.data("id"),type:"GET",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),d.closest(".modal-content").addLoader()},complete:function(){d.closest(".modal-content").removeLoader(),removeFlashMessenger()},success:function(b){d.bindForm($.extend($.extend({},a),b))},error:function(a){showFlashMessenger(d,[{type:"danger",icon:"error",message:"Produto não encontrado."}]),removeFlashMessenger()}})}),$(document).on("click",".products-remove",function(a){a.preventDefault();var b=$(this);confirm("Deseja remover este produto?")&&$.ajax({url:basePath+"/products/"+b.data("id"),type:"DELETE",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),$("#app").addLoader()},complete:function(){},success:function(a){updateProductsList()},error:function(a){var b=$("main form");$("#app").removeLoader(),showFlashMessenger(b,[{type:"danger",icon:"error",message:"Produto não encontrado."}]),removeFlashMessenger()}})}),$(document).on("click","#products-remove-all",function(a){a.preventDefault(),confirm("Deseja remover estes produtos?")&&$.ajax({url:basePath+"/products",type:"DELETE",dataType:"json",data:$("#form-products-list").serialize(),beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),$("#app").addLoader()},complete:function(){},success:function(a){updateProductsList()},error:function(a){$("#app").removeLoader();var b=$("main form");showFlashMessenger(b,[{type:"danger",icon:"error",message:"Produtos não encontrados."}]),removeFlashMessenger()}})}),$(document).on("change",'input[name="ids[]"]',function(){checkSelectedProducts()}),$(document).on("click",".products-view",function(a){a.preventDefault();var b=$(this),c=$("#modal-product .details");$.ajax({url:basePath+"/products/"+b.data("id"),type:"GET",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),c.find("#product-name").html(""),c.closest(".modal-content").addLoader()},complete:function(){c.closest(".modal-content").removeLoader(),removeFlashMessenger()},success:function(a){c.find("#product-name").html(a.name),c.find("#product-description").html(a.description),c.find("#product-price").html(a.price),c.find("#product-stock").html(a.stock)},error:function(a){var b=$("main form");showFlashMessenger(b,[{type:"danger",icon:"error",message:"Produto não encontrado."}]),removeFlashMessenger(),c.closest(".modal").modal("hide")}})}),$(document).on("click","#send-report",function(a){a.preventDefault(),confirm("Deseja gerar o relatório e encaminhá-lo por email?")&&$.ajax({url:basePath+"/products/report",type:"GET",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),$("#app").addLoader()},complete:function(){$("#app").removeLoader(),removeFlashMessenger()},success:function(a){var b=$("main form");showFlashMessenger(b,[{type:"success",icon:"check_circle",message:"Relatório enviado com sucesso!"}])},error:function(a){var b=$("main form");showFlashMessenger(b,[{type:"danger",icon:"error",message:"Não foi possível enviar o relatório."}])}})}),$(".form-search").on("submit",function(a){a.preventDefault();var b=$.trim($(this).find("#element_q").val());$('input[name="q"]').val(b),updateProductsList()}),$(document).on("click",".products-filter",function(a){a.preventDefault(),$('input[name="q"]').val(""),updateProductsList()}),$("#element_price").maskMoney({thousands:""})});