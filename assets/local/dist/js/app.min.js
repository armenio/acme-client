$(document).ready(function(){"object"!=typeof jwt.user&&($("body").css("min-height",$(window).height()),$("*").removeLoader(),$("body").addLoader(),window.location.href="login.html");var a=function(){var a=$(window).height(),b=$("#header").height(),c=a-b;$("#content").height(c)};a(),$(window).on("resize",function(){a()});var b=function(){$(".navbar-toggler").is(":visible")&&$(".navbar-toggler").trigger("click")};$("aside .form-search").on("submit",function(a){b()}),$(document).on("click","aside a",function(a){b()})});var checkSelectedProducts=function(){$('input[name="ids[]"]:checked').length?$("#products-remove-all").show():$("#products-remove-all").hide()};Vue.component("component-search",{template:"#component-search",props:["q"]});var vm=new Vue({el:"#app",data:{q:"",products:[]}}),updateProductsList=function(){var a=vm.q;axios.get(basePath+"/products",{params:{q:a,order:"stock",by:"asc"}}).then(function(a){vm.products=a.data}).catch(function(a){console.log(a)})};$(document).ready(function(){"object"==typeof jwt&&"string"==typeof jwt.token&&(axios.defaults.headers.common.Authorization="Bearer "+jwt.token),updateProductsList();var a={id:"",name:"",description:"",price:"",stock:""};$(document).on("click",".products-add, .product-edit",function(b){b.preventDefault();var c=$("#modal-products form");c.closest(".modal").find(".alert, .validation-message").length>0&&c.closest(".modal").find(".alert, .validation-message").remove(),c.bindForm($.extend({},a)),setTimeout(function(){c.find("#element_name").focus()},500)}),$("#modal-products form").zfAjaxForm({beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token);var b=$(this);b.closest(".modal").find(".alert, .validation-message").remove(),b.closest(".modal-content").addLoader()},complete:function(){$(this).closest(".modal-content").removeLoader()},success:function(a){$(this).closest(".modal").modal("hide"),updateProductsList()},error:function(a){var b=$(this),c=a.responseJSON;"string"==typeof c.message&&(showFlashMessenger(b,[{type:"danger",icon:"error",message:"Não foi possível validar os dados."}]),removeFlashMessenger()),"object"==typeof c.errors&&showFormErrorMessages(b,c.errors)}}),$(document).on("click",".product-edit",function(b){b.preventDefault();var c=$(this),d=$("#modal-products form");$.ajax({url:basePath+"/products/"+c.data("id"),type:"GET",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),d.closest(".modal-content").addLoader()},complete:function(){d.closest(".modal-content").removeLoader(),removeFlashMessenger()},success:function(b){d.bindForm($.extend($.extend({},a),b))},error:function(a){showFlashMessenger(d,[{type:"danger",icon:"error",message:"Produto não encontrado."}]),removeFlashMessenger()}})}),$(document).on("click",".products-remove",function(a){a.preventDefault();var b=$(this);confirm("Deseja remover este produto?")&&$.ajax({url:basePath+"/products/"+b.data("id"),type:"DELETE",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),$("#content").addLoader()},complete:function(){},success:function(a){updateProductsList()},error:function(a){var b=$("main form");$("#content").removeLoader(),showFlashMessenger(b,[{type:"danger",icon:"error",message:"Produto não encontrado."}]),removeFlashMessenger()}})}),$(document).on("click","#products-remove-all",function(a){a.preventDefault(),confirm("Deseja remover estes produtos?")&&$.ajax({url:basePath+"/products",type:"DELETE",dataType:"json",data:$("#form-products-list").serialize(),beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),$("#content").addLoader()},complete:function(){},success:function(a){updateProductsList()},error:function(a){$("#content").removeLoader();var b=$("main form");showFlashMessenger(b,[{type:"danger",icon:"error",message:"Produtos não encontrados."}]),removeFlashMessenger()}})}),$(document).on("change",'input[name="ids[]"]',function(){checkSelectedProducts()}),$(document).on("click",".products-view",function(a){a.preventDefault();var b=$(this),c=$("#modal-product .details");$.ajax({url:basePath+"/products/"+b.data("id"),type:"GET",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),c.find("#product-name").html(""),c.closest(".modal-content").addLoader()},complete:function(){c.closest(".modal-content").removeLoader(),removeFlashMessenger()},success:function(a){c.find("#product-name").html(a.name),c.find("#product-description").html(a.description),c.find("#product-price").html(a.price),c.find("#product-stock").html(a.stock)},error:function(a){var b=$("main form");showFlashMessenger(b,[{type:"danger",icon:"error",message:"Produto não encontrado."}]),removeFlashMessenger(),c.closest(".modal").modal("hide")}})}),$(document).on("click","#send-report",function(a){a.preventDefault(),confirm("Deseja gerar o relatório e encaminhá-lo por email?")&&$.ajax({url:basePath+"/products/report",type:"GET",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+jwt.token),$("#content").addLoader()},complete:function(){$("#content").removeLoader(),removeFlashMessenger()},success:function(a){var b=$("main form");showFlashMessenger(b,[{type:"success",icon:"check_circle",message:"Relatório enviado com sucesso!"}])},error:function(a){var b=$("main form");showFlashMessenger(b,[{type:"danger",icon:"error",message:"Não foi possível enviar o relatório."}])}})}),$(".form-search").on("submit",function(a){a.preventDefault();var b=$.trim($(this).find("#element_q").val());$('input[name="q"]').val(b),updateProductsList()}),$(document).on("click",".products-filter",function(a){a.preventDefault(),updateProductsList()}),$("#element_price").maskMoney({thousands:""})});